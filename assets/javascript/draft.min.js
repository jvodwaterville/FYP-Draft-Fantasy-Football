function loadThisPage(){getDraftDetails(),checkPick(),document.getElementById("selectPremTeam").setAttribute("onChange","changePage(1)"),document.getElementById("selectPosition").setAttribute("onChange","changePage(1)"),document.getElementById("selectName").setAttribute("onKeyUp","changePage(1)"),$('[class="playerName"]:visible').each(function(){this.setAttribute("onClick","openPlayerInfo(this.id, event);")}),teamCurrentlyPicking==GETARRAY.squadid?$(".tradeButton").show():$(".tradeButton").hide()}function countDownTimer(){var e=document.getElementById("theTimer");countDownTime++;var t=selectionTime-countDownTime,a=Math.floor(t/60),n=t-60*a,r=str_pad_left(a,"0",2)+":"+str_pad_left(n,"0",2);if(e.innerHTML="Time Remaining : "+r,0==t){var e=document.getElementById("selectionAlertBox");e.innerHTML="",e.style.display="none",document.getElementById("wrapper").style.opacity="1",clearInterval(countDown),$.ajax({url:"index.php?selectrandomplayer=true&squadid="+teamCurrentlyPicking+"&picknumber="+draftPickNumber,cache:!1,success:function(e){checkPick()}}),countDownTime=0,countDown=setInterval(countDownTimer,1e3)}}function str_pad_left(e,t,a){return(new Array(a+1).join(t)+e).slice(-a)}function checkPick(){document.getElementById("thePlayers");$.ajax({url:"index.php?checkdraftpick=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){var t=JSON.parse(e),a=t.pickNo,n=t.pickTeam,r=t.status;if(1==r)(n!=teamCurrentlyPicking||draftPickNumber!=a)&&(clearInterval(countDown),countDownTime=0,countDown=setInterval(countDownTimer,1e3),teamCurrentlyPicking=n,draftPickNumber=a,changePage(currentFreeAgentPage),loadThisPage(),document.getElementById("pickText").innerHTML="Pick Order - Pick #"+a+" in progress",n==GETARRAY.squadid?$(".tradeButton").show():$(".tradeButton").hide());else if(0==r)if(teamCurrentlyPicking=0,clearInterval(countDown),"Yes"==leagueAdmin){var o=document.getElementById("theTimer");o.innerHTML="<button class='draftButton' onclick='startDraft()'>Start Draft</button>"}else{var o=document.getElementById("theTimer");o.innerHTML="Draft hasn't started yet"}else{teamCurrentlyPicking=0,clearInterval(countDown);var o=document.getElementById("theTimer");o.innerHTML="<div class='draftButton'><a href='index.php?squad=true&squadid="+GETARRAY.squadid+"'>Draft Finished - View Squad</a></div>"}}})}function getDraftDetails(){$.ajax({url:"index.php?getteamleaguedetails=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){var t=JSON.parse(e);leagueAdmin=t.leagueAdmin,console.log(leagueAdmin),draftStatus=t.draftStatus,selectionTime=t.selectionTime,document.getElementById("wynText").innerHTML=t.teamName+" - What you need",document.getElementById("teamNameLeagueName").innerHTML="<div class='draftButton'><a href='index.php?dash=true'>Exit</a></div>"}}),$.ajax({url:"index.php?getplayersperposition=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){var t=JSON.parse(e);document.getElementById("gkCount").innerHTML=t.Goalkeepers,gks=t.Goalkeepers,document.getElementById("dfCount").innerHTML=t.Defenders,dfs=t.Defenders,document.getElementById("mfCount").innerHTML=t.Midfielders,mfs=t.Midfielders,document.getElementById("fwCount").innerHTML=t.Forwards,fws=t.Forwards}}),$.ajax({url:"index.php?getdraftorder=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){for(var t=JSON.parse(e),a=Object.keys(t).length,n='<table class="pickTable">',r=1,o=1;18>=o;o++)if(n+='<tr class="roundColumn"><td colspan="2">Round: '+o+'</td></tr><tr class="headingColumn"><td>#</td><td>Team</td></tr>',o%2!=0)for(var i=1;a>=i;i++)n+="<tr><td>"+r+"</td><td>"+t[i]+"</td></tr>",r++;else for(var i=a;i>=1;i--)n+="<tr><td>"+r+"</td><td>"+t[i]+"</td></tr>",r++;n+="</table>",document.getElementById("pickTableHolder").innerHTML=n}}),$.ajax({url:"index.php?getdrafthistory=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){for(var t=JSON.parse(e),a=t.length,n='<table class="pickTable"><tr class="roundColumn"><td>#</td><td>Team</td><td>Player</td></tr>',r=a-1;r>=0;r--){var o=r+1;n+="<tr><td>"+o+"<td>"+t[r][0]+"</td><td>"+t[r][1]+"</td></tr>"}n+="</table>",document.getElementById("historyTableHolder").innerHTML=n}})}function selectPlayer(e){var t=e.substr(6),a=document.getElementById("position"+t).innerHTML,n=document.getElementById("selectionAlertBox");if("GK"==a&&0==gks)var r='<p>You already have 2 Goalkeepers</p> <button onclick="cancelSelection()">Ok</button>';else if("DF"==a&&0==dfs)var r='<p>You already have 6 Defenders</p> <button onclick="cancelSelection()">Ok</button>';else if("MF"==a&&0==mfs)var r='<p>You already have 6 Midfielders</p> <button onclick="cancelSelection()">Ok</button>';else if("FW"==a&&0==fws)var r='<p>You already have 4 Forwards</p> <button onclick="cancelSelection()">Ok</button>';else var o=document.getElementById(t).innerHTML,r="<p>Confirm Selection of "+o+'</p> <button onclick="addPlayerToSquad('+t+')">Confirm</button><button onclick="cancelSelection()">Cancel</button>';n.innerHTML=r,document.getElementById("wrapper").style.opacity="0.25",n.style.display="block"}function addPlayerToSquad(e){if(teamCurrentlyPicking==GETARRAY.squadid)$.ajax({url:"index.php?addplayertosquad=true&squadid="+GETARRAY.squadid+"&playerid="+e,cache:!1,success:function(e){var t=document.getElementById("selectionAlertBox");t.innerHTML="",t.style.display="none",document.getElementById("wrapper").style.opacity="1",loadThisPage(),changePage(1)}});else{alert("No Cheating!");var t=document.getElementById("selectionAlertBox");t.innerHTML="",document.getElementById("wrapper").style.opacity="1",t.style.display="none"}}function cancelSelection(){var e=document.getElementById("selectionAlertBox");e.innerHTML="",document.getElementById("wrapper").style.opacity="1",e.style.display="none"}function startDraft(){$.ajax({url:"index.php?startdraft=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){loadThisPage(),changePage(1)}}),$.ajax({url:"index.php?generatefixtures=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){loadThisPage(),changePage(1)}})}function changePage(e){currentFreeAgentPage=e;var t="<tr><th>Pos</th><th>Player</th><th>Team</th><th>TP</th><th>Select</th></tr>",a=document.getElementById("selectPosition").value,n=document.getElementById("selectPremTeam").value;if(""==document.getElementById("selectName").value)var r="Any";else var r=document.getElementById("selectName").value;var o;o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o.onreadystatechange=function(){4==o.readyState&&200==o.status&&(document.getElementById("freeAgentsTable").innerHTML=t+o.responseText,loadThisPage())},o.open("GET","index.php?getavailableplayers=true&page="+e+"&position="+a+"&premTeam="+n+"&name="+r+"&squadid="+GETARRAY.squadid,!0),o.send()}var GETARRAY={};if(-1!==document.location.toString().indexOf("?"))for(var query=document.location.toString().replace(/^.*?\?/,"").replace(/#.*$/,"").split("&"),i=0,l=query.length;l>i;i++){var aux=decodeURIComponent(query[i]).split("=");GETARRAY[aux[0]]=aux[1]}window.onload=loadThisPage;var myVar=setInterval(checkPick,2e3),leagueAdmin="No",currentFreeAgentPage=1,draftStatus=0,selectionTime=0,countDownTime=0,teamCurrentlyPicking=0,draftPickNumber=0,gks=0,dfs=0,mfs=0,fws=0,countDown=setInterval(countDownTimer,1e3);